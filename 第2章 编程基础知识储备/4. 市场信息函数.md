# 4. 市场信息函数

市场信息函数可以获取指定货币对的相关信息数据,包括:

- 货币对的卖价
- 货币对的买价
- 货币对的点差
- 货币对的最大下单量
- 货币对的最小下单量
- 等

- `double MarketInfo(string symbol, int type)`
  - `symbol`: 货币对名称,如`EURJPY`
  - `type`: 信息类型,可以是以下常量之一:
    - `MODE_BID`: 最新收到的买价
    - `MODE_ASK`: 最新收到的卖价
    - `MODE_POINT`: 当前报价的点值
    - `MODE_DIGITS`: 在货币对价格中,小数点后面的小数位数
    - `MODE_SPREAD`: 货币对的点差
    - `MODE_STOPLEVEL`: 可以允许的最小止损位距离点数
    - `MODE_LOTSIZE`: 基本货币的标准手大小
    - `MODE_TICKVALUE`: 当前品种报价每一跳的价值
    - `MODE_SWAPLONG`: 看涨仓位掉期
    - `MODE_SWAPSHORT`: 卖空仓位掉期
    - `MODE_MINLOT`: 允许交易的最小手数
    - `MODE_LOTSTEP`: 交易手数的最小增量
    - `MODE_MAXLOT`: 允许交易的最大手数
    - `MODE_MARGININIT`: 标准手的初始保证金需求
  - 返回值: 对应类型的信息值,如果失败则返回0

`MarketInfo()`函数可以获取指定货币对的选定数值,只需要在指定货币对的同时指定信息数据类型(即`type`参数)即可.
和账户信息函数一样,此处只对经常使用的函数做一个解释说明,更多的信息请查阅MQL4帮助文档.

```mq4
//+------------------------------------------------------------------+
//| Expert tick function                                             |
//+------------------------------------------------------------------+
void OnTick()
  {
//---
   PrintBid();
   PrintAsk();
   PrintPoint();
   PrintDigits();
   PrintSperad();
  }
  
//+------------------------------------------------------------------+
void PrintBid() {
   // bid: 最新收到的买价
   double bid = MarketInfo("EURJPY", MODE_BID);
   string bidStr = StringFormat("%g", bid);
   Print("最新收到的买价为: " + bidStr);
}

void PrintAsk() {
   // ask: 最新收到的卖价
   double ask = MarketInfo("EURJPY", MODE_ASK);
   string askStr = StringFormat("%g", ask);
   Print("最新收到的卖价为: " + askStr);
}

void PrintPoint() {
   // print: 当前报价的点值
   double point = MarketInfo("EURJPY", MODE_POINT);
   string pointStr = StringFormat("%g", point);
   // 这里打印出来的点值一直是0.001 不知道为什么
   Print("当前报价的点值为: " + pointStr);
}

void PrintDigits() {
   // digits: 在货币对价格中,小数点后面的小数位数
   // Tips: 小数位数逻辑上认为应该是个整数 这里只是API为了统一 返回的类型均为double
   double digits = MarketInfo("EURJPY", MODE_DIGITS);
   string digitsStr = StringFormat("%g", digits);
   Print("当前货币对价格中,小数点后面的小数位数为: " + digitsStr);
}

void PrintSperad() {
   // spread: 货币对的点差
   double spread = MarketInfo("EURJPY", MODE_SPREAD);
   string spreadStr = StringFormat("%g", spread);
   Print("货币对的点差为: " + spreadStr);
}
```

- 点值: 当前品种报价最小变动单位的大小
  - 通常和`MODE_DIGITS`相关: `Point = 10^(-MODE_DIGITS)`
  - 例如`EURJPY`的`MODE_DIGITS`为3,则点值为0.001

- 点差: 买价和卖价之间的差值
  - `点差 = 卖价 - 买价`,即`Spread = Ask - Bid`
  - 点差不会为负数

报价规则:

- Bid: 我能卖出的价格(经纪商买入价)
- Ask: 我能买入的价格(经纪商卖出价)
- Spread: 买价和卖价之间的差值(点差)
- 经纪商不会用低于买入价的价格卖给我,因此`Ask >= Bid`
  - TODO: 那我和经纪商之间的交易不就成了我一直在亏钱了么?
  - 还是说整个过程是"我从别人手里买入,再以Bid价格卖出给经纪商"/"我从经纪商手里以Ask价格买入,再卖出给别人"?
