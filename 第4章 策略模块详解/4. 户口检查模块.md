# 4. 户口检查模块

```mq4
// currencyPair 货币对
string currencyPair;

// MAGIC 魔术号,和EA是1对1关系.本质是一个用户自定义的订单标识.用于在同一个账户中,标识不同EA下的订单
int MAGIC = 106;

// 本函数用于检查账户的各种情况
void checkAccount() {
   // 历史总下单量(总交易手数)
   double totalHistoricalOrders = 0;
   
   // 历史总盈亏
   double totalHistoricalProfitAndLoss = 0;
   
   // 当前货币对的历史下单量(交易手数)
   double historicalOrders = 0;
   
   // 当前货币对的历史盈亏
   double historicalProfitAndLoss = 0;
   
   // 指定货币对已平仓买单的数量
   int mbbo = 0;
   
   // 指定货币对已平仓买单的盈亏总和
   double mbbProfito = 0;
   
   // 指定货币对已平仓卖单的数量
   int msso = 0;
   
   // 指定货币对已平仓卖单的盈亏总和
   double mssProfito = 0;
   
   // 指定MAGIC下 已平仓的买单数量(不区分货币对)
   int bb = 0;
   
   // 指定MAGIC下 已平仓买单的盈亏总和(不区分货币对)
   double bbProfit = 0;
   
   // 指定MAGIC下 已平仓的卖单数量(不区分货币对)
   int ss = 0;
   
   // 指定MAGIC下 已平仓卖单的盈亏总和(不区分货币对)
   double ssProfit = 0;
   
   // 已平仓的买单数量(不区分货币对)
   int bb1 = 0;
   
   // 已平仓的买单盈亏总和(不区分货币对)
   double bbProfit1 = 0;
   
   // 已平仓的卖单数量(不区分货币对)
   int ss1 = 0;
   
   // 已平仓的卖单盈亏总和(不区分货币对)
   double ssProfit1 = 0;
   
   // 所有未删除的SELLSTOP挂单总数量(不区分货币对)
   int ossa = 0;
   
   // 所有未删除的SELLLIMIT挂单总数量(不区分货币对)
   int osla = 0;
   
   // 所有未删除的BUYSTOP挂单总数量(不区分货币对)
   int obsa = 0;
   
   // 所有未删除的BUYLIMIT挂单总数量(不区分货币对)
   int obla = 0;
   
   // 所有未平仓的买单中 处于浮盈状态的买单数量(不区分货币对)
   int Twbs = 0;
   
   // 所有未平仓的买单中 浮盈总和
   double Twin = 0;
   
   // 所有未平仓的买单中 处于浮亏状态的买单数量(不区分货币对)
   int Tlbs = 0;
   
   // 所有未平仓的买单中 浮亏总和
   double Tloss = 0;
   
   // 所有未平仓订单的交易手数
   double TOTALLOTS = 0;
   
   // 指定货币对下 所有未平仓买单的总手数
   double BLOTS = 0;
   
   // 指定货币对下 所有未平仓买单的总数量
   int mbb = 0;
   
   // 指定货币对下 所有未平仓买单的盈亏总和
   double mbbProfit = 0;
   
   // 指定货币对下 所有未平仓卖单的总手数
   double SLOTS = 0;
   
   // 指定货币对下 所有未平仓卖单的总数量
   int mss = 0;
   
   // 指定货币对下 所有未平仓卖单的盈亏总和
   double mssProfit = 0;
   
   // 指定货币对下 所有SELLSTOP挂单的总数量
   int moss = 0;
   
   // 指定货币对下 所有SELLLIMIT挂单的总数量
   int mosl = 0;
   
   // 指定货币对下 所有BUYSTOP挂单的总数量
   int mobs = 0;
   
   // 指定货币对下 所有BUYLIMIT挂单的总数量
   int mobl = 0;
   
   // 指定货币对的总盈亏
   double profitmm = 0;
   
   // 指定货币对 指定MAGIC下的 未平仓卖单的总下单量(交易手数)
   double TLOTSS = 0;
   
   // 指定货币对 指定MAGIC下的 未平仓卖单的总数量
   int s = 0;
   
   // 指定货币对 指定MAGIC下的 未平仓卖单的盈亏总和
   double sProfit = 0;
   
   // 指定货币对 指定MAGIC下的 所有未平仓卖单中 距当前最近的卖单的最近开盘价格
   double LastPriceSell = 0;
   
   // 指定货币对 指定MAGIC下的 未平仓买单的总下单量(交易手数)
   double TLOTSB = 0;
   
   // 指定货币对 指定MAGIC下的 未平仓买单的总数量
   int b = 0;
   
   // 指定货币对 指定MAGIC下的 未平仓买单的盈亏总和
   double bProfit = 0;
   
   // 指定货币对 指定MAGIC下的 所有未平仓买单中 距当前最近的买单的最近开盘价格
   double LastPriceBuy = 0;
   
   // 指定货币对 指定MAGIC下的 所有未平仓订单的总交易手数
   double TLOTS = 0;
   
   // 指定货币对 指定MAGIC下的 未删除的SELLSTOP挂单总数量
   int oss = 0;
   
   // 指定货币对 指定MAGIC下的 未删除的SELLLIMIT挂单总数量
   int osl = 0;
   
   // 指定货币对 指定MAGIC下的 未删除的BUYSTOP挂单总数量
   int obs = 0;
   
   // 指定货币对 指定MAGIC下的 未删除的BUYLIMIT挂单总数量
   int obl = 0;
   
   // 指定货币对 指定MAGIC下的 所有未平仓卖单中 距当前最近的卖单的下单量(交易手数)
   double SLASTLOTS = 0;
   
   // 指定货币对 指定MAGIC下的 所有未平仓卖单中 距当前最近的买单的下单量(交易手数)
   double BLASTLOTS = 0;
   
   for (int r = 0; r < OrdersHistoryTotal(); r++) {
      bool historySelectResult = OrderSelect(r, SELECT_BY_POS, MODE_HISTORY);
      
      if (!historySelectResult) {
         continue;
      }
      
      if (OrderType() == OP_BUY || OrderType() == OP_SELL) {
         // 历史总下单量(总交易手数)
         totalHistoricalOrders += OrderLots();
         // 历史总盈亏
         totalHistoricalProfitAndLoss += OrderProfit() + OrderCommission() + OrderSwap();
         
         if (OrderSymbol() == currencyPair) {
            // 当前货币对的历史下单量(交易手数)
            historicalOrders += OrderLots();
            // 当前货币对的历史盈亏
            historicalProfitAndLoss += OrderProfit() + OrderCommission() + OrderSwap();
            
            if (OrderType() == OP_BUY) {
               // 指定货币对已平仓买单的数量
               mbbo++;
               // 指定货币对已平仓买单的盈亏总和
               mbbProfito += OrderProfit() + OrderCommission() + OrderSwap();
            }
            
            if (OrderType() == OP_SELL) {
               // 指定货币对已平仓卖单的数量
               msso++;
               // 指定货币对已平仓卖单的盈亏总和
               mssProfito += OrderProfit() + OrderCommission() + OrderSwap();
            }
         }
      }
   }
   
   for (int cnt = 0; cnt < OrdersTotal(); cnt++) {
      bool selectResult = OrderSelect(cnt, SELECT_BY_POS, MODE_TRADES);
      if (!selectResult) {
         continue;
      }
      
      if (OrderType() == OP_BUY && OrderMagicNumber() == MAGIC) {
         // 指定MAGIC下 已平仓的买单数量(不区分货币对)
         bb++;
         // 指定MAGIC下 已平仓买单的盈亏总和(不区分货币对)
         bbProfit += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if (OrderType() == OP_SELL && OrderMagicNumber() == MAGIC) {
         // 指定MAGIC下 已平仓的卖单数量(不区分货币对)
         ss++;
         // 指定MAGIC下 已平仓卖单的盈亏总和(不区分货币对)
         ssProfit += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if (OrderType() == OP_BUY) {
         // 已平仓的买单数量(不区分货币对)
         bb1++;
         // 已平仓的买单盈亏总和(不区分货币对)
         bbProfit1 += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if (OrderType() == OP_SELL) {
         // 已平仓的卖单数量(不区分货币对)
         ss1++;
         // 已平仓的卖单盈亏总和(不区分货币对)
         ssProfit1 += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if (OrderType() == OP_SELLSTOP) {
         // 所有未删除的SELLSTOP挂单总数量(不区分货币对)
         ossa++;
      }
      
      if (OrderType() == OP_SELLLIMIT) {
         // 所有未删除的SELLLIMIT挂单总数量(不区分货币对)
         osla++;
      }
      
      if (OrderType() == OP_BUYSTOP) {
          // 所有未删除的BUYSTOP挂单总数量(不区分货币对)
         obsa++;
      }
      
      if (OrderType() == OP_BUYLIMIT) {
          // 所有未删除的BUYLIMIT挂单总数量(不区分货币对)
         obla++;
      }
      
      if ( (OrderType() == OP_BUY || OrderType() == OP_SELL) && (OrderProfit() + OrderCommission() + OrderSwap() > 0)) {
         // 所有未平仓的买单中 处于浮盈状态的买单数量(不区分货币对)
         Twbs++;
         // 所有未平仓的买单中 浮盈总和
         Twin += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if ( (OrderType() == OP_BUY || OrderType() == OP_SELL) && (OrderProfit() + OrderCommission() + OrderSwap() < 0)) {
         // 所有未平仓的买单中 处于浮亏状态的买单数量(不区分货币对)
         Tlbs++;
         // 所有未平仓的买单中 浮亏总和
         Tloss += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if (OrderType() == OP_BUY || OrderType() == OP_SELL) {
         // 所有未平仓订单的交易手数
         TOTALLOTS += OrderLots();
      }
      
      if (OrderSymbol() == currencyPair) {
         if (OrderType() == OP_BUY) {
            // 指定货币对下 所有未平仓买单的总手数
            BLOTS += OrderLots();
            // 指定货币对下 所有未平仓买单的总数量
            mbb++;
            // 指定货币对下 所有未平仓买单的盈亏总和
            mbbProfit += OrderProfit() + OrderCommission() + OrderSwap();
         }
         
         if (OrderType() == OP_SELL) {
            // 指定货币对下 所有未平仓卖单的总手数
            SLOTS += OrderLots();
            // 指定货币对下 所有未平仓卖单的总数量
            mss++;
            // 指定货币对下 所有未平仓卖单的盈亏总和
            mssProfit += OrderProfit() + OrderCommission() + OrderSwap();
         }
         
         if (OrderType() == OP_SELLSTOP) {
            // 指定货币对下 所有SELLSTOP挂单的总数量
            moss++;
         }
         
         if (OrderType() == OP_SELLLIMIT) {
            // 指定货币对下 所有SELLLIMIT挂单的总数量
            mosl++;
         }
         
         if (OrderType() == OP_BUYSTOP) {
            // 指定货币对下 所有BUYSTOP挂单的总数量
            mobs++;
         }
         
         if (OrderType() == OP_BUYLIMIT) {
            // 指定货币对下 所有BUYLIMIT挂单的总数量
            mobl++;
         }
         
         // 指定货币对的总盈亏
         profitmm += OrderProfit() + OrderCommission() + OrderSwap();
      }
      
      if (OrderSymbol() == currencyPair && OrderMagicNumber() == MAGIC) {
         if (OrderType() == OP_SELL) {
            // 指定货币对 指定MAGIC下的 未平仓卖单的总下单量(交易手数)
            TLOTSS += OrderLots();
            // 指定货币对 指定MAGIC下的 未平仓卖单的总数量
            s++;
            // 指定货币对 指定MAGIC下的 所有未平仓卖单中 距当前最近的卖单的下单量(交易手数)
            SLASTLOTS = OrderLots();
            // 指定货币对 指定MAGIC下的 未平仓卖单的盈亏总和
            sProfit += OrderProfit() + OrderCommission() + OrderSwap();
            // 指定货币对 指定MAGIC下的 所有未平仓卖单中 距当前最近的卖单的最近开盘价格
            LastPriceSell = OrderOpenPrice();
         }
         
         if (OrderType() == OP_BUY) {
            // 指定货币对 指定MAGIC下的 未平仓买单的总下单量(交易手数)
            TLOTSB += OrderLots();
             // 指定货币对 指定MAGIC下的 未平仓买单的总数量
            b++;
            // 指定货币对 指定MAGIC下的 所有未平仓卖单中 距当前最近的买单的下单量(交易手数)
            BLASTLOTS = OrderLots();
            // 指定货币对 指定MAGIC下的 未平仓买单的盈亏总和
            bProfit += OrderProfit() + OrderCommission() + OrderSwap();
            // 指定货币对 指定MAGIC下的 所有未平仓买单中 距当前最近的买单的最近开盘价格
            LastPriceBuy = OrderOpenPrice();
         }
         
         if (OrderType() == OP_SELL || OrderType() == OP_BUY) {
             // 指定货币对 指定MAGIC下的 所有未平仓订单的总交易手数
            TLOTS += OrderLots();
         }
         
         if (OrderType() == OP_SELLSTOP) {
            // 指定货币对 指定MAGIC下的 未删除的SELLSTOP挂单总数量
            oss++;
         }
         
         if (OrderType() == OP_SELLLIMIT) {
            // 指定货币对 指定MAGIC下的 未删除的SELLLIMIT挂单总数量
            osl++;
         }
         
         if (OrderType() == OP_BUYSTOP) {
            // 指定货币对 指定MAGIC下的 未删除的BUYSTOP挂单总数量
            obs++;
         }
         
         if (OrderType() == OP_BUYLIMIT) {
            // 指定货币对 指定MAGIC下的 未删除的BUYLIMIT挂单总数量
            obl++;
         }
      }
   }
}
```

各变量含义如注释所示,总结如下(如有出入以注释为准):

|              变量名称              |                 变量意义                  |
|:------------------------------:|:-------------------------------------:|
|    `totalHistoricalOrders`     |            已经平仓的所有订单下单量之和             |
| `totalHistoricalProfitAndLoss` |             已经平仓的所有订单总的盈亏             |
|       `historicalOrders`       |           指定货币对已平仓订单的下单量之和            |
|   `historicalProfitAndLoss`    |            指定货币对已平仓订单的盈亏之和            |
|             `mbbo`             |             指定货币对已平仓买单的数量             |
|          `mbbprofito`          |           指定货币对已平仓的买单的盈亏之和            |
|             `msso`             |             指定货币对已平仓卖单的数量             |
|          `mssprofito`          |           指定货币对已平仓的卖单的盈亏之和            |
|              `bb`              |     指定`MAGIC`数值已平仓的买单数量之和(不区分货币对)     |
|           `bbprofit`           |     指定`MAGIC`数值已平仓的买单盈亏之和(不区分货币对)     |
|              `ss`              |     指定`MAGIC`数值已平仓的卖单数量之和(不区分货币对)     |
|           `ssprofit`           |     指定`MAGIC`数值已平仓的卖单盈亏之和(不区分货币对)     |
|             `bb1`              |          已平仓的买单数量之和(不区分货币对)           |
|          `bbprofit1`           |          已平仓的买单盈亏之和(不区分货币对)           |
|             `ss1`              |          已平仓的卖单数量之和(不区分货币对)           |
|          `ssprofit1`           |          已平仓的卖单盈亏之和(不区分货币对)           |
|             `ossa`             |     所有未删除的`SELLSTOP`挂单的数量(不区分货币对)     |
|             `osla`             |    所有未删除的`SELLLIMIT`挂单的数量(不区分货币对)     |
|             `obsa`             |     所有未删除的`BUYSTOP`挂单的数量(不区分货币对)      |
|             `obla`             |     所有未删除的`BUYLIMIT`挂单的数量(不区分货币对)     |
|             `Twbs`             |      所有未平单的买中单盈利单子的数量之和(不区分货币对)       |
|             `Twin`             |      所有未平单的买中单盈利单子的盈利之和(不区分货币对)       |
|             `Tlbs`             |      所有未平单的买中单亏损单子的数量之和(不区分货币对)       |
|            `Tloss`             |      所有未平单的买中单亏损单子的亏损之和(不区分货币对)       |
|          `TOTALLots`           |             所有未平的订单手单量之和              |
|            `BLOTS`             |           指定货币对所有未平的买单下单量之和           |
|             `mbb`              |           指定货币对所有未平的买单数量之和            |
|          `mbbprofit`           |           指定货币对所有未平的买单的盈亏之和           |
|            `SLOTS`             |           指定货币对所有未平的卖单下单量之和           |
|             `mss`              |           指定货币对所有未平的卖单数量之和            |
|          `mssprofit`           |           指定货币对所有未平的卖单盈亏之和            |
|             `moss`             |        指定货币对的`SELLSTOP`挂单数量之和         |
|             `mosl`             |        指定货币对的`SELLLIMIT`挂单数量之和        |
|             `mobs`             |         指定货币对的`BUYSTOP`挂单数量之和         |
|             `mobl`             |        指定货币对的`BUYLIMIT`挂单数量之和         |
|           `profitmm`           |              指定货币对的总的盈亏               |
|            `TLOTSS`            |      指定货币对指定`MAGIC`数值未平仓的卖单下单量之和      |
|              `s`               |      指定货币对指定`MAGIC`数值未平仓的卖单数量之和       |
|           `sprofit`            |      指定货币对指定`MAGIC`数值未平仓的卖单盈亏之和       |
|        `LastPricesell`         |     指定货币对指定`MAGIC`数值未平仓的最近卖单的开盘价格     |
|            `TLOTSB`            |      指定货币对指定`MAGIC`数值未平仓的买单下单量之和      |
|              `b`               |      指定货币对指定`MAGIC`数值未平仓的买单数量之和       |
|           `bprofit`            |      指定货币对指定`MAGIC`数值未平仓的买单盈亏之和       |
|         `LastPricebuy`         |     指定货币对指定`MAGIC`数值未平仓的最近买单的开盘价格     |
|            `TLOTS`             |     指定货币对指定`MAGIC`数值未平仓的订单的下单量之和      |
|             `oss`              | 指定货币对指定`MAGIC`数值未删除的`SELLSTOP`挂单数量之和  |
|             `osl`              | 指定货币对指定`MAGIC`数值未删除的`SELLLIMIT`挂单数量之和 |
|             `obs`              |  指定货币对指定`MAGIC`数值未删除的`BUYSTOP`挂单数量之和  |
|             `obl`              | 指定货币对指定`MAGIC`数值未删除的`BUYLIMIT`挂单数量之和  |
|          `SLASTLOTS`           |     指定货币对指定`MAGIC`数值未平仓的最近卖单的下单量      |
|          `BLASTLOTS`           |     指定货币对指定`MAGIC`数值未平仓的最近买单的下单量      |
